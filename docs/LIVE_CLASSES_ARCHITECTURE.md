# Live Classes Architecture: Three-Scenario Support

## **üéØ Overview**

This document outlines the architecture to support three distinct live class scenarios:
1. **Institution Course (Live Classes Only)**
2. **Institution Course (Blended Learning)** 
3. **Platform-wide Courses (Live Classes Only)**

---

## **üìä Database Schema Enhancements**

### **1. Enhanced Course Model**

```typescript
model Course {
  // ... existing fields ...
  
  // Live Class Configuration
  liveClassType        String?  // 'LIVE_ONLY', 'BLENDED', 'SELF_PACED'
  liveClassFrequency   String?  // 'WEEKLY', 'BIWEEKLY', 'MONTHLY', 'CUSTOM'
  liveClassSchedule    Json?    // Detailed schedule configuration
  hasLiveClasses       Boolean  @default(false)
  
  // Relations
  recurringSessions    RecurringSessionPattern[]
  liveClassSessions    VideoSession[]
}
```

### **2. New Recurring Session Pattern Model**

```typescript
model RecurringSessionPattern {
  id                String   @id @default(uuid())
  courseId          String   // Link to course
  patternType       String   // 'RECURRING', 'SCHEDULED', 'MANUAL'
  frequency         String   // 'WEEKLY', 'BIWEEKLY', 'MONTHLY', 'CUSTOM'
  
  // Schedule Configuration
  dayOfWeek         Int?     // 0-6 (Sunday-Saturday)
  timeOfDay         String   // 'HH:MM' format
  duration          Int      // Session duration in minutes
  timezone          String   @default('UTC')
  
  // Date Range
  startDate         DateTime
  endDate           DateTime
  
  // Session Configuration
  maxParticipants   Int      @default(10)
  isPublic          Boolean  @default(false)
  isRecorded        Boolean  @default(false)
  allowChat         Boolean  @default(true)
  allowScreenShare  Boolean  @default(true)
  
  // Status
  isActive          Boolean  @default(true)
  autoGenerate      Boolean  @default(true) // Auto-create sessions
  
  // Relations
  course            Course   @relation(fields: [courseId], references: [id])
  sessions          VideoSession[]
  
  @@index([courseId])
  @@index([isActive])
  @@map("recurring_session_patterns")
}
```

### **3. Enhanced VideoSession Model**

```typescript
model VideoSession {
  // ... existing fields ...
  
  // Recurring Session Support
  recurringPatternId String?  // Link to recurring pattern
  sessionNumber      Int?     // Which session in the series (1, 2, 3...)
  isRecurring        Boolean  @default(false)
  isAutoGenerated    Boolean  @default(false)
  
  // Session Type Classification
  sessionType        String   @default("REGULAR") // 'REGULAR', 'WORKSHOP', 'Q&A', 'REVIEW'
  
  // Relations
  recurringPattern   RecurringSessionPattern? @relation(fields: [recurringPatternId], references: [id])
}
```

---

## **üîß Implementation for Each Scenario**

### **Scenario 1: Institution Course (Live Classes Only)**

#### **Course Creation Flow:**
```typescript
// 1. Create course with live class configuration
const course = await prisma.course.create({
  data: {
    title: "Conversational Spanish - Live Only",
    liveClassType: "LIVE_ONLY",
    liveClassFrequency: "WEEKLY",
    hasLiveClasses: true,
    startDate: new Date("2024-01-15"),
    endDate: new Date("2024-04-15"),
    // ... other course fields
  }
});

// 2. Create recurring session pattern
const pattern = await prisma.recurringSessionPattern.create({
  data: {
    courseId: course.id,
    patternType: "RECURRING",
    frequency: "WEEKLY",
    dayOfWeek: 2, // Tuesday
    timeOfDay: "18:00",
    duration: 90,
    startDate: new Date("2024-01-16"),
    endDate: new Date("2024-04-16"),
    maxParticipants: 12,
    isPublic: false,
    autoGenerate: true
  }
});

// 3. Auto-generate sessions
await generateSessionsFromPattern(pattern.id);
```

#### **Session Generation Logic:**
```typescript
async function generateSessionsFromPattern(patternId: string) {
  const pattern = await prisma.recurringSessionPattern.findUnique({
    where: { id: patternId },
    include: { course: true }
  });
  
  if (!pattern || !pattern.autoGenerate) return;
  
  const sessions = [];
  let currentDate = new Date(pattern.startDate);
  let sessionNumber = 1;
  
  while (currentDate <= pattern.endDate) {
    // Check if it's the correct day of week
    if (currentDate.getDay() === pattern.dayOfWeek) {
      const startTime = new Date(currentDate);
      const [hours, minutes] = pattern.timeOfDay.split(':');
      startTime.setHours(parseInt(hours), parseInt(minutes), 0, 0);
      
      const endTime = new Date(startTime.getTime() + pattern.duration * 60 * 1000);
      
      sessions.push({
        title: `${pattern.course.title} - Session ${sessionNumber}`,
        sessionType: "REGULAR",
        startTime,
        endTime,
        duration: pattern.duration,
        maxParticipants: pattern.maxParticipants,
        isRecurring: true,
        isAutoGenerated: true,
        sessionNumber,
        recurringPatternId: pattern.id,
        courseId: pattern.courseId,
        instructorId: pattern.course.instructorId,
        institutionId: pattern.course.institutionId,
        // ... other fields
      });
      
      sessionNumber++;
    }
    
    // Move to next week
    currentDate.setDate(currentDate.getDate() + 7);
  }
  
  // Bulk create sessions
  await prisma.videoSession.createMany({
    data: sessions
  });
}
```

### **Scenario 2: Institution Course (Blended Learning)**

#### **Course Creation Flow:**
```typescript
// 1. Create course with blended configuration
const course = await prisma.course.create({
  data: {
    title: "Business English - Blended",
    liveClassType: "BLENDED",
    hasLiveClasses: true,
    startDate: new Date("2024-01-15"),
    endDate: new Date("2024-06-15"),
    // ... other course fields
  }
});

// 2. Create specific live session patterns (not recurring)
const workshopPattern = await prisma.recurringSessionPattern.create({
  data: {
    courseId: course.id,
    patternType: "SCHEDULED",
    frequency: "MONTHLY",
    dayOfWeek: 4, // Thursday
    timeOfDay: "19:00",
    duration: 120,
    startDate: new Date("2024-01-18"),
    endDate: new Date("2024-06-20"),
    maxParticipants: 15,
    isPublic: false,
    autoGenerate: true
  }
});

const qaPattern = await prisma.recurringSessionPattern.create({
  data: {
    courseId: course.id,
    patternType: "SCHEDULED", 
    frequency: "BIWEEKLY",
    dayOfWeek: 1, // Monday
    timeOfDay: "17:00",
    duration: 60,
    startDate: new Date("2024-01-22"),
    endDate: new Date("2024-06-17"),
    maxParticipants: 20,
    isPublic: false,
    autoGenerate: true
  }
});
```

### **Scenario 3: Platform-wide Courses (Live Classes Only)**

#### **Course Creation Flow:**
```typescript
// 1. Create platform course
const course = await prisma.course.create({
  data: {
    title: "Global English Conversation",
    liveClassType: "LIVE_ONLY",
    liveClassFrequency: "WEEKLY",
    hasLiveClasses: true,
    institutionId: null, // Platform course
    startDate: new Date("2024-01-15"),
    endDate: new Date("2024-12-31"),
    // ... other course fields
  }
});

// 2. Create multiple recurring patterns for different time zones
const patterns = [
  {
    dayOfWeek: 1, // Monday
    timeOfDay: "09:00",
    timezone: "UTC",
    maxParticipants: 20
  },
  {
    dayOfWeek: 1, // Monday  
    timeOfDay: "18:00",
    timezone: "UTC",
    maxParticipants: 20
  },
  {
    dayOfWeek: 3, // Wednesday
    timeOfDay: "14:00", 
    timezone: "UTC",
    maxParticipants: 20
  }
];

for (const patternConfig of patterns) {
  await prisma.recurringSessionPattern.create({
    data: {
      courseId: course.id,
      patternType: "RECURRING",
      frequency: "WEEKLY",
      ...patternConfig,
      duration: 90,
      startDate: new Date("2024-01-15"),
      endDate: new Date("2024-12-31"),
      isPublic: true,
      autoGenerate: true
    }
  });
}
```

---

## **üéõÔ∏è Management Interface**

### **Course Creation Wizard**

```typescript
interface CourseCreationData {
  // Basic course info
  title: string;
  description: string;
  level: string;
  language: string;
  
  // Live class configuration
  liveClassType: 'LIVE_ONLY' | 'BLENDED' | 'SELF_PACED';
  hasLiveClasses: boolean;
  
  // Schedule configuration (if has live classes)
  liveClassSchedule?: {
    frequency: 'WEEKLY' | 'BIWEEKLY' | 'MONTHLY' | 'CUSTOM';
    sessions: {
      dayOfWeek: number;
      timeOfDay: string;
      duration: number;
      maxParticipants: number;
      sessionType: 'REGULAR' | 'WORKSHOP' | 'Q&A';
    }[];
  };
  
  // Course duration
  startDate: Date;
  endDate: Date;
}
```

### **Live Class Management Dashboard**

```typescript
interface LiveClassManagement {
  // View all sessions for a course
  sessions: VideoSession[];
  
  // Manage recurring patterns
  patterns: RecurringSessionPattern[];
  
  // Actions
  generateSessions: (patternId: string) => Promise<void>;
  updatePattern: (patternId: string, data: Partial<RecurringSessionPattern>) => Promise<void>;
  cancelSessions: (sessionIds: string[]) => Promise<void>;
  rescheduleSessions: (sessionIds: string[], newDate: Date) => Promise<void>;
}
```

---

## **üîê Access Control**

### **Scenario-based Access**

```typescript
// Scenario 1 & 2: Institution courses
if (course.institutionId) {
  // Only institution staff can manage
  if (user.role !== 'INSTITUTION_STAFF' || user.institutionId !== course.institutionId) {
    throw new Error('Unauthorized');
  }
}

// Scenario 3: Platform courses  
if (!course.institutionId) {
  // Only admins can manage
  if (user.role !== 'ADMIN') {
    throw new Error('Unauthorized');
  }
}
```

---

## **üìà Benefits of This Architecture**

### **For Institutions:**
- ‚úÖ **Flexible Course Design**: Support both live-only and blended learning
- ‚úÖ **Automated Session Creation**: Reduce manual work
- ‚úÖ **Consistent Scheduling**: Predictable session times
- ‚úÖ **Easy Management**: Centralized control over live class patterns

### **For Students:**
- ‚úÖ **Clear Expectations**: Know when sessions will occur
- ‚úÖ **Consistent Experience**: Regular session schedule
- ‚úÖ **Flexible Participation**: Multiple session options for platform courses

### **For Platform:**
- ‚úÖ **Scalable Architecture**: Support all three scenarios
- ‚úÖ **Revenue Optimization**: Better course completion rates
- ‚úÖ **Global Reach**: Time zone support for platform courses

---

## **üöÄ Implementation Roadmap**

### **Phase 1: Core Infrastructure**
1. Add database schema changes
2. Create recurring session pattern model
3. Implement session generation logic

### **Phase 2: Management Interface**
1. Course creation wizard with live class options
2. Live class management dashboard
3. Session editing and cancellation tools

### **Phase 3: Advanced Features**
1. Time zone support
2. Holiday and break scheduling
3. Session conflict detection
4. Automated notifications

This architecture provides a flexible, scalable solution that supports all three live class scenarios while maintaining simplicity and ease of use. 